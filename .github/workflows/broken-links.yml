name: ğŸ”— Kontrola internÃ­ch odkazÅ¯

on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * 1'

jobs:
  check-links:
    runs-on: ubuntu-latest
    
    # --- ZMÄšNA ÄŒ. 1 ---
    # PÅ™idÃ¡me workflow oprÃ¡vnÄ›nÃ­ vytvÃ¡Å™et issues
    permissions:
      contents: read  # PotÅ™ebnÃ© pro checkout
      issues: write   # PotÅ™ebnÃ© pro vytvÃ¡Å™enÃ­ issues

    steps:
      - name: 1. StÃ¡hnout kÃ³d repozitÃ¡Å™e
        uses: actions/checkout@v4

      - name: 2. Nastavit Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 3. Instalovat potÅ™ebnÃ© knihovny
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 lxml

      - name: 4. Spustit kontrolu odkazÅ¯
        id: check_links_step # DÃ¡me kroku ID
        continue-on-error: true # DÅ®LEÅ½ITÃ‰: PokraÄuj, i kdyÅ¾ skript selÅ¾e
        run: |
          python check_links.py ${{ vars.SITEMAP_URL_PROD }}

      # --- ZMÄšNA ÄŒ. 2 ---
      # Krok 5 (create-github-app-token) byl smazÃ¡n.
      # Krok 6 je nynÃ­ krok 5 a pouÅ¾Ã­vÃ¡ vestavÄ›nÃ½ token.
      - name: 5. VytvoÅ™it Issue v pÅ™Ã­padÄ› chyby
        # Tento krok se spustÃ­ POUZE, pokud krok 4 selhal
        if: steps.check_links_step.outcome == 'failure' 
        uses: peter-evans/create-issue-from-file@v5
        with:
          # PouÅ¾ijeme bezpeÄnÃ½ a vestavÄ›nÃ½ GITHUB_TOKEN
          token: ${{ secrets.GITHUB_TOKEN }}
          title: 'ğŸš¨ NefunkÄnÃ­ internÃ­ odkazy na webu'
          content-filepath: ./broken_links_report.md
          labels: |
            bug
            broken-links
            automated
