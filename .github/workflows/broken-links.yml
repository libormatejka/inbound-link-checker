name: ğŸ”— Kontrola internÃ­ch odkazÅ¯

on:
  workflow_dispatch:
  schedule:
    - cron: '0 6 * * 1'

jobs:
  check-links:
    runs-on: ubuntu-latest

    steps:
      - name: 1. StÃ¡hnout kÃ³d repozitÃ¡Å™e
        uses: actions/checkout@v4

      - name: 2. Nastavit Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 3. Instalovat potÅ™ebnÃ© knihovny
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 lxml

      - name: 4. Spustit kontrolu odkazÅ¯
        id: check_links_step # PÅ™idali jsme ID pro tento krok
        continue-on-error: true # DÅ®LEÅ½ITÃ‰: PokraÄuj, i kdyÅ¾ skript selÅ¾e
        run: |
          python check_links.py ${{ vars.SITEMAP_URL_PROD }}

      - name: 5. VytvoÅ™it Issue v pÅ™Ã­padÄ› chyby
        # Tento krok se spustÃ­ POUZE, pokud krok "check_links_step" selhal
        if: steps.check_links_step.outcome == 'failure'
        uses: actions/create-github-app-token@v1 # Akce pro bezpeÄnÃ½ token
        id: app-token

      - name: 6. Publikovat Issue
        if: steps.check_links_step.outcome == 'failure' # SpustÃ­ se jen pÅ™i chybÄ›
        uses: peter-evans/create-issue-from-file@v5
        with:
          token: ${{ steps.app-token.outputs.token }}
          title: 'ğŸš¨ NefunkÄnÃ­ internÃ­ odkazy na webu'
          content-filepath: ./broken_links_report.md
          labels: |
            bug
            broken-links
            automated
